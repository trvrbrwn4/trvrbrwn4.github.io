<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="author" content="Trevor Brown"/>
		<meta name="copyright" content="Copyright © Trevor Brown 2021. All rights reserved.">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <meta property="og:title" content="MusiCalculator" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://trvrbrwn4.github.io/MusiCalculator.html" />
        <meta property="og:image" content="media/images/meta preview/musicalc meta.png" />
        <meta property="og:description" content="Calculate tempo and key info" />
        <meta name="theme-color" content="#00FF00">

		<title>>TAB [MusiCalculator]</title>
        <link rel="icon" href="media/images/icon.png">
		<link rel="stylesheet" type="text/css" href="styles/siteStyle.css">
        <style>
            body {
                overflow-x: hidden;
                touch-action: manipulation;
            }
            #scaleSelector li { /* User Scale Selector */
                font-size: 24px;
            }
            #relativeNames { /* Calculated Relative Scales */
                font-size: 32px;
            }
            #scaleDegrees li { /* Calculated Scale Keys */
                font-size: 20px;
            }
            .rightSide ul li { /* User Frequency Selector */
                font-size: 24px;
            }
            #output>div>p { /* Both Sets of Outputs (tempo, freq) */
                font-size: 20px;
            }

            h1, h2, h3, h4, h5, h6 { /* Page Title */
                font-size: 48px;
                margin-bottom: 16px;
            }
            .toolBox > h1 {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            #tapTempoControls {
                margin-bottom: 8px;
            }
            #tapTempo {
                width: 80px;
                height: 40px;
                border-radius: 10px;
                background-color: #ffffff;
                margin: 0 0 0 32px;
                font-size: 24px;
                font-weight: 600;
                color: #000000;
            }
            #tapTempo:hover {
                transition: all .3s ease;
                cursor: pointer;
                background-color: #aaffaa;
            }
            .restart {
                width: 40px;
                height: 40px;
                border-radius: 10px;
                background-color: #ffffff;
                margin: 0 0 0 32px;
                font-size: 24px;
                font-weight: 600;
                color: #000000;
            }
            .restart:hover {
                background-color: #ffaaaa;
                cursor: help;
                transform: scale(1.05);
                transition: all .3s ease-out;
            }
            .toolBox {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: auto;
                margin: 16px 0;
                border-top: 4px solid #fff;
                border-bottom: 4px solid #fff;
                padding: 16px;
            }
            .toolBox > div {
                display: inline-block;
                margin-bottom: 8px;
            }
            .toolBox input {
                text-align: center;
                color: #777;
                border: none;
                border-radius: 10px;
                padding: 4px 8px;
                width: 20%;
                min-width: 60px;
            }
            .toolBox input:focus::placeholder {
                color: transparent;
            }
            
            .toolBox ul {
                display: flex;
                flex-direction: row;
                justify-content: space-evenly;
                list-style-type: none;
                cursor: default;
                user-select: none;
            }
            .toolBox ul li {
                display: inline-block;
                list-style-type: none;
                cursor: pointer;
                font-weight: 500;
                transition: all .3s ease;
            }
            #userTempo {
                background-color: transparent;
            }
            #userTempo input:focus {
                caret-color: #ffffff;
            }
            #bpmDiv {
                font-weight: 400;
            }
            #noteSelector, #bpmDiv {
                display: inline-block;
            }
            #noteSelector {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            #tempoTimes {
                display: flex;
                align-items: center;
                justify-content: space-around;
                margin-bottom: 0;
            }
            #keySelector, #bpmDiv, #scaleSelector, #noteSelector {
                color: #555; 
            }
            #keySelector li:hover:not(.activeSelection), #scaleSelector li:hover:not(.activeSelection) {
                color: #888;
                border-bottom: 2px solid #888;
                transform: scale(1.05);
            }
            #keySelector li {
                font-size: 24px;
                margin: 0 1vw;
            }
            #scaleSelector li {
                margin: 0 1vw;
            }
            #keySelector li, #scaleSelector li, #noteSelector li {
                padding: 2px 4px;
                border-radius: 10px;
            }
            .menuBar {
                width: 80%;
                height: 4px;
                margin-bottom: 8px;
                background-color: #fff;
            }
            #relativeNames {
                font-weight: 900;
            }
            #scaleDegrees {
                margin-top: -16px;
            }
            #scaleDegrees li {
                cursor: default;
                margin: 0 2vw;
            }
            .splitBox {
                width: 98vw;
            }
            .leftSide, .rightSide {
                width: 46%;
                padding: 1%;
                margin: 0 1%;
            }
            .leftSide {
                float: left;
            }
            .rightSide {
                float: right;
            }
            .rightSide ul li {
                color: #555;
            }
            .splitBox>div>p {
                margin: 4px 0 0 4px;
                font-weight: 400;
            }
            .activeSelection, .toolbox input:not(:placeholder-shown) {
                color: #1de840 !important;
                border-bottom: 4px solid #1de840 !important;
                background-color: #1b4222 !important;
            }
            .draggableItem {
                transition: all .3s ease;
            }
            .draggableItem:hover {
                cursor: pointer;
                color: #1de840;
                text-decoration: underline;
                transform: scale(1.1);
            }
            .draggableItem::selection {
                color: #e81d1d;
                background-color: #333333;
            }
            .extra {
                font-weight: 300;
            }
            .extra input:focus {
                caret-color: #000000;
            }
            .info {
                font-style: italic;
                font-weight:200;
            }
            .dragInfo, .meterFreqs  {
                visibility: hidden;
                position: absolute;
            }
            .scaleInfo {
                visibility: hidden;
                position: absolute;
            }
            #beDetuneAmount, #beBeatingAmount, #pitchDif {
                font-weight: 800;
            }
            #beDetuneAmount, #beBeatingAmount {
                color: #e3e81d;
            }
            #pitchDif{
                color: #dd00f3;
            }
            .harmonics {
                width: 58%;
                padding: 1%;
                max-width: 800px;
                height: 240px;
                overflow-y: scroll;
                cursor: ns-resize;
                border: 2px solid white;
                border-radius: 20px;
            }
            .harmonics > p {
                font-size: 24px;
            }
            #oddHarm span {
                color: #e8b71d;
            }
            #evenHarm span {
                color: #1ddde8;
            }

            /******************** MEDIA QUERIES ********************/
            @media only screen and (min-width: 0px) and (max-width: 600px) { /* For Tablets */
                h1{ /* Page Title */
                    font-size: 48px;
                }
                h2 { /* Other Titles */
                    font-size: 28px;
                }
                #keySelector li { /* User Key Selector */
                    font-size: 12px;
                    margin: 0 1vw;
                }
                #scaleSelector li { /* User Scale Selector */
                    font-size: 12px;
                    margin: 0 1vw;
                }
                #relativeNames { /* Calculated Relative Scales */
                    font-size: 20px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 12px;
                    margin: 0 1vw;
                }
                .toolBox input { /* User BPM input box */
                    font-size: 20px;
                }
                #bpmDiv { /* bpm text */
                    font-size: 20px;
                }
                #tapTempoControls {
                    display: block;
                    margin-top: 8px;
                }
                #noteSelector li { /* User Frequency Selector */
                    font-size: 12px;
                    padding: 2px;
                }
                .splitBox>div>p { /* Calculated meter/freqs */
                    font-size: 10px;
                }
                .outputShrink { /* Note / Octave text in output */
                    display: none;
                }
                .extra > span { /* space between input fields on reese/pitch extras */
                    display: block;
                    margin: 4px 0;
                }
                .extra input { /* all inputs in extras */
                    font-size: 24px;
                }
                #beDetuneAmount, #beBeatingAmount, #pitchDif { /* outputs from reese/pitch extras */
                    font-size: 16px;
                }
                .harmonics { /* Container box for harmonic boxes */
                    width: 100%;
                    padding: 0;
                    font-size: 48px;
                }
                #oddHarm, #evenHarm { /* odd/even harmonic boxes */
                    width: 44%;
                    margin: 0 1%;
                    padding: none;
                }
                #oddHarm p, #oddHarm span, #evenHarm p, #evenHarm span { /* odd/even  harmonic output */
                    font-size: 16px;
                }
            }
            @media only screen and (min-width: 600px) and (max-width: 800px) { /* For Smaller Computers */
                h1 { /* Page Title */
                    font-size: 48px;
                }
                h2 { /* Other Titles */
                    font-size: 40px;
                }
                #keySelector li { /* User Key Selector */
                    font-size: 16px;
                }
                #scaleSelector li { /* User Scale Selector */
                    font-size: 16px;
                }
                #relativeNames { /* Calculated Relative Scales */
                    font-size: 20px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 12px;
                }
                .toolBox input { /* User BPM input box */
                    font-size: 20px;
                }
                #bpmDiv { /* bpm text */
                    font-size: 20px;
                }
                #tapTempoControls {
                    display: block;
                    margin-top: 8px;
                }
                #noteSelector li { /* User Frequency Selector */
                    font-size: 16px;
                }
                .splitBox>div>p { /* Calculated meter/freqs */
                    font-size: 16px;
                }
                .outputShrink { /* Note / Octave text in output */
                    display: none;
                }
                .extra > span { /* space between input fields on reese/pitch extras */
                    padding: 0 4px;
                }
                .extra input { /* all inputs in extras */
                    font-size: 24px;
                }
                #beDetuneAmount, #beBeatingAmount, #pitchDif { /* outputs from reese/pitch extras */
                    font-size: 20px;
                }
                .harmonics { /* Container box for harmonic boxes */
                    width: 100%;
                    padding: 0;
                    font-size: 48px;
                }
                #oddHarm, #evenHarm { /* odd/even harmonic boxes */
                    width: 44%;
                    margin: 0 1%;
                    padding: none;
                }
                #oddHarm p, #oddHarm span, #evenHarm p, #evenHarm span { /* odd/even  harmonic output */
                    font-size: 20px;
                }
            }
            @media only screen and (min-width: 800px) and (max-width: 1200px) { /* For Computers */
                h1 { /* Page Title */
                    font-size: 48px;
                }
                h2 { /* Other Titles */
                    font-size: 40px;
                }
                #keySelector li { /* User Key Selector */
                    font-size: 16px;
                }
                #scaleSelector li { /* User Scale Selector */
                    font-size: 16px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 16px;
                }
                .toolBox input { /* User BPM input box */
                    font-size: 20px;
                }
                #bpmDiv { /* bpm text */
                    font-size: 24px;
                }
                #noteSelector li { /* User Frequency Selector */
                    font-size: 16px;
                }
                .extra { /* extra font by textboxes but not the textboxes */
                    font-size: 20px;
                }
                .extra > span { /* space between input fields on reese/pitch extras */
                    padding: 0 32px;
                }
                .extra input { /* all inputs in extras */
                    font-size: 28px;
                }
                #beDetuneAmount, #beBeatingAmount, #pitchDif { /* outputs from reese/pitch extras */
                    font-size: 24px;
                }
                #oddHarm p, #oddHarm span, #evenHarm p, #evenHarm span { /* odd/even  harmonic output */
                    font-size: 20px;
                }
            }
            @media only screen and (min-width: 1200px) and (max-width: 4000px) { /* For Bigger Computers */
                h1 { /* Page Title */
                    font-size: 64px;
                }
                h2 { /* Other Titles */
                    font-size: 48px;
                }
                #relativeNames { /* Calculated Relative Scales */
                    font-size: 40px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 24px;
                }
                .toolBox input { /* User BPM input box */
                    font-size: 32px;
                }
                #bpmDiv { /* bpm text */
                    font-size: 32px;
                }
                .splitBox>div>p { /* Calculated meter/freqs */
                    font-size: 20px;
                }
                .extra { /* extra font by textboxes but not the textboxes */
                    font-size: 24px;
                }
                .extra > span { /* space between input fields on reese/pitch extras */
                    padding: 0 64px;
                }
                .extra input { /* all inputs in extras */
                    font-size: 32px;
                }
                #beDetuneAmount, #beBeatingAmount, #pitchDif { /* outputs from reese/pitch extras */
                    font-size: 28px;
                }
                .harmonics { /* Container box for harmonic boxes */
                    height: 400px;
                }
                #oddHarm p, #oddHarm span, #evenHarm p, #evenHarm span { /* odd/even  harmonic output */
                    font-size: 24px;
                }
            }
        </style>
	</head>
	<body onload="loader();">
        <div class="toolBox rainbowBorder">
            <h1><strong>MusiCalc</strong><button class="restart" onclick="resetData();">↺</button></h1>


            <div><ul id="keySelector"></ul></div>
            <div><ul id="scaleSelector"></ul></div>
            <div class="scaleInfo"></div>
            <div id="relativeNames" class="scaleInfo"></div>
            <div class="scaleInfo"></div>
            <div><ul id="scaleDegrees" class="scaleInfo"></ul></div>
            <span class="menuBar"></span>

            <div class="splitBox" id="tempoTimes"><div id="bpmDiv" class="leftSide"><input type="text" id="userTempo" placeholder="?" oninput="bpmInput();"> BPM <span id="tapTempoControls"><button id="tapTempo" onclick="tapTempo();">Tap</button><button class="restart" onclick="resetTempo();">↺</button></span></div><ul id="noteSelector" class="rightSide"></ul></div>
            <div class="info dragInfo">Click on values to highlight them and copy to clipboard!</div>
            <div class="splitBox meterFreqs"><div class="leftSide" id="meter"></div><div class="rightSide" id="freqs"></div></div>
            <div class="info dragInfo">Click and drag highlighted values into the textboxes below to copy the value!</div>
            <span class="menuBar"></span>

            <h2><strong>Beating Effect: Detune Finder</strong></h2>
            <div class="info">Calculate the amount of cents to detune two notes by for a precise hz of 'beating'</div>
            <div class="extra">hz of base note: <input type="text" class="dragReceiver" id="beReeseNote" placeholder="?" oninput="beDetuneFinder();"><span></span>hz of desired beating: <input type="text" class="dragReceiver" id="beReeseRate" placeholder="?" oninput="beDetuneFinder();"></div>
            <div id="beDetuneAmount"></div>

            <h2><strong>Beating Effect: Beat hz Finder</strong></h2>
            <div class="info">Calculate the hz of 'beating' between two notes</div>
            <div class="extra">hz of first note: <input type="text" class="dragReceiver" id="beBeatingOne" placeholder="?" oninput="beBeatingFinder();"><span></span>hz of second note: <input type="text" class="dragReceiver" id="beBeatingTwo" placeholder="?" oninput="beBeatingFinder();"></div>
            <div id="beBeatingAmount"></div>

            <h2><strong>Pitched Loop BPM Finder</strong></h2>
            <div class="info">Calculate the new bpm of a loop that has been pitched up or down</div>
            <div class="extra">Original BPM: <input type="text" class="dragReceiver" id="pitchBpm" placeholder="?" oninput="pitchbpmInput();"><span></span>Pitch difference (in st): <input type="text" class="dragReceiver" id="pitchPitch" placeholder="?" oninput="pitchbpmInput();"></div>
            <div id="pitchDif"></div>
            
            <h2><strong>Harmonic Calculator</strong></h2>
            <div class="info">Calculate the odd & even harmonics of a given frequency!</div>
            <div class="extra">Fundamental Frequency: <input type="text" class="dragReceiver" placeholder="?" id="harmonicFreq"></div>
            <div class="splitBox harmonics"><div class="leftSide" id="oddHarm"></div><div class="rightSide" id="evenHarm"></div></div>
        </div>
        <div class="footer">
            <ul class="socialMenu">
                <a href="https://www.instagram.com/trvrbrwn4/" target="_blank"><li><img src="media/images/socials/instagram.png"></li></a>
            </ul>
            Copyright © 2022. All rights reserved.
        </div>
        <script id="DragDropTouch" src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
		<script src="scripts/siteScript.js" type="text/javascript"></script>
        <script type="text/javascript">

            // data used for many parts of the program
            const freqs = [16.351, 17.324, 18.354, 19.445, 20.601, 21.827, 23.124, 24.499, 25.956, 27.5, 29.135, 30.868];
            //               C       C#      D       D#      E       F       F#      G       G#      A     A#      B
            const noteArray = "C C# D D# E F F# G G# A A# B".split(" ");

            const scaleArray = "Ionian (Major) : Dorian : Phrygian : Lydian : Mixolydian : Aeolian (Minor) : Locrian".split(" : ");
            const modeSequences = {
                "Ionian": "W W H W W W H",
                "Dorian": "W H W W W H W",
                "Phrygian": "H W W W H W W",
                "Lydian": "W W W H W W H",
                "Mixolydian": "W W H W W H W",
                "Aeolian": "W H W W H W W",
                "Locrian": "H W W H W W W"
            };

            // UX trackers (per refresh)
            var timesReset = 0, popupHidden = false;

            // on load, populate the selectors and append any stored data
            window.onload = function() {

                // PAGE INITIALIZATION FEATURES
                // ----------------------------
                // append buttons and eventListeners to objects on the page

                // function for managing activeSelection class and corresponding memory values
                const selectorHelper = function(toRemove, toAdd, valueKey, value="") {
                    if (toRemove) {
                        toRemove.classList.remove("activeSelection");
                    }
                    if (toAdd) {
                        toAdd.classList.add("activeSelection");
                    }
                    if (valueKey && value) {
                        memory(valueKey, value);
                    } else {
                        memory(valueKey, "");
                    }

                };

                // key selector
                noteArray.forEach(function(item, index) {

                    // each key li has innerHTML: "C", "C#", "D", etc.
                    const li = createElement("li", item);

                    // each key li gets an id of: "C", "C#", "D", etc.
                    li.id = item;

                    li.addEventListener("click", function() {
                        // grab 'old' key (the currently selected key when clicked)
                        const oldKeyName = memory("MusiUserKey");

                        if (oldKeyName) { 
                            if (oldKeyName == this.innerHTML) {

                                // if the old key is the same as the new key, remove
                                selectorHelper(this, null, "MusiUserKey");
                            } else {

                                // if the old key is different than the new key, remove old and add new
                                selectorHelper(document.getElementById(oldKeyName), this, "MusiUserKey", this.innerHTML);
                            }
                        } else {

                            // if there is no old key, add new 
                            selectorHelper(null, this, "MusiUserKey", this.innerHTML);
                        }

                        calculateScale();
                    });
                        document.querySelector("#keySelector").appendChild(li);
                    });

                // scale selector
                scaleArray.forEach(function(item, index) {

                    // each scale li has innerHTML: "Ionian", "Dorian", "Phrygian", etc.
                    const li = createElement("li", item);

                    // each scale li gets id of: "Ionian", "Dorian", "Phrygian", etc.
                    li.id = item.split(" ")[0];

                    li.addEventListener("click", function() {
                        // grab 'old' scale (the currently selected scale when clicked)
                        const oldScaleName = memory("MusiUserScale");

                        if (oldScaleName) {
                            if (oldScaleName == this.innerHTML.split(" ")[0]) {

                                // if the old scale name is the same as the current selection, remove
                                selectorHelper(this, null, "MusiUserScale");
                            } else {

                                // if the old scale name is different than the current selection, remove old and add new
                                selectorHelper(document.getElementById(oldScaleName), this, "MusiUserScale", this.innerHTML.split(" ")[0]);
                            }
                        } else {

                            // if there is no old scale name, add new
                            selectorHelper(null, this, "MusiUserScale", this.innerHTML.split(" ")[0]);
                        }
                        calculateScale();
                    });
                    document.querySelector("#scaleSelector").appendChild(li);
                });

                // note selector
                noteArray.forEach(function(item, index) {

                    // each li has innerHTML: "C", "C#", "D", etc.
                    const li = createElement("li", item);

                    // each note li gets id of: 'C 0', 'C# 1', 'D 2', etc.
                    li.id = item+" "+index;

                    li.addEventListener("click", function() {
                        // grab 'old' note (the currently selected note when clicked)
                        const oldNoteName = memory("MusiUserNote");

                        if (oldNoteName) {
                            if (oldNoteName.split(" ")[0] == this.innerHTML) {

                                // if the old note name is the same as the current selection, remove
                                selectorHelper(this, null, "MusiUserNote");
                            } else {

                                // if the old note name is different than the current selection, remove old and add new
                                selectorHelper(document.getElementById(oldNoteName), this, "MusiUserNote", this.id);
                            }
                        } else {

                            // if there is no old note name, add new
                            selectorHelper(null, this, "MusiUserNote", this.id);
                        }
                        showMeterFreqs();
                    });
                    document.querySelector("#noteSelector").appendChild(li);
                });

                // adds drop functionality to the extra textboxes (computer)
                for (var i = 0; i < document.getElementsByClassName("dragReceiver").length; i++) {
                    document.getElementsByClassName("dragReceiver")[i].addEventListener("drop", function(event) {
                        event.preventDefault();
                        this.value = "";
                        this.value = event.dataTransfer.getData("Text");

                        // this checks what drag box was just dropped on, and calls the respective function
                        const extratype = this.id.slice(0, 5);
                        switch (extratype) {
                            case "beRee": beDetuneFinder();break;
                            case "beBea": beBeatingFinder();break;
                            case "pitch": pitchbpmInput();break;
                            case "harmo": harmoniCalc();break;
                        }
                    });
                }

                // input delay on the harmonicalc
                const delay = 500;
                var timeout;

                // after the user stops typing for delay amount, harmoniCalc will run
                document.getElementById("harmonicFreq").addEventListener("keyup", function(e){
                    clearTimeout(timeout);
                    timeout = setTimeout(function() {
                        harmoniCalc();
                    }, delay);
                });

                // PAGE DATA PERSISTENCE
                // ----------------------------
                // if any selections are made, load the respective data and call the corresponding function

                const selectedKey = memory("MusiUserKey");
                if (selectedKey) {
                    const currentKey = document.getElementById(selectedKey);
                    if (currentKey) {
                        currentKey.classList.add("activeSelection");
                    }
                }
                const selectedScale = memory("MusiUserScale");
                if (selectedScale) {
                    const currentScale = document.getElementById(selectedScale);
                    if (currentScale) {
                        currentScale.classList.add("activeSelection");
                    }
                }
                if (selectedKey || selectedScale) {
                    calculateScale();
                }

                const selectedBpm = memory("MusiUserTempo");
                if (selectedBpm) {
                    document.getElementById("userTempo").value = selectedBpm;
                    document.getElementById("userTempo").oninput();
                }
                const selectedNote = memory("MusiUserNote");
                if (selectedNote) {
                    const currentNote = document.getElementById(selectedNote);
                    if (currentNote) {
                        currentNote.classList.add("activeSelection");
                    }
                }
                showMeterFreqs();

                if (memory("MusiBEReeseNote")) {
                    document.getElementById("beReeseNote").value = memory("MusiBEReeseNote");
                }
                if (memory("MusiBEReeseRate")) {
                    document.getElementById("beReeseRate").value = memory("MusiBEReeseRate");
                }
                beDetuneFinder();
                if (memory("MusiBEBeatingOne")) {
                    document.getElementById("beBeatingOne").value = memory("MusiBEBeatingOne");
                }
                if (memory("MusiBEBeatingTwo")) {
                    document.getElementById("beBeatingTwo").value = memory("MusiBEBeatingTwo");
                }
                beBeatingFinder();

                if (memory("MusiPitchBpm")) {
                    document.getElementById("pitchBpm").value = memory("MusiPitchBpm");
                }
                if (memory("MusiPitchPitch")) {
                    document.getElementById("pitchPitch").value = memory("MusiPitchPitch");
                }
                pitchbpmInput();

                if (memory("MusiHarmFreq")) {
                    document.getElementById("harmonicFreq").value = memory("MusiHarmFreq");
                }
                harmoniCalc();
            };

            // for reset button
            function resetData() {

                // does the resetting
                const resetter = function() {
                    // tracks if data gets deleted
                    var dataDeleted = false;

                    const oldBpm = memory("MusiUserTempo");
                    if (oldBpm) {
                        memory("MusiUserTempo", "");
                        document.querySelector("#userTempo").value = "";
                        bpmInput();
                        dataDeleted = true;
                    }

                    const oldKeyName = memory("MusiUserKey");
                    if (oldKeyName) {
                        document.getElementById(oldKeyName).classList.remove("activeSelection");
                        memory("MusiUserKey", "");
                        dataDeleted = true;
                    }

                    const oldScaleName = memory("MusiUserScale");
                    if (oldScaleName) {
                        document.getElementById(oldScaleName).classList.remove("activeSelection");
                        memory("MusiUserScale", "");
                        calculateScale();
                        dataDeleted = true;
                    }

                    const oldNoteName = memory("MusiUserNote");
                    if (oldNoteName) {
                        document.getElementById(oldNoteName).classList.remove("activeSelection");
                        memory("MusiUserNote", "");

                        showMeterFreqs();
                        dataDeleted = true;
                    }

                    for (var i = 0; i < document.getElementsByClassName("dragReceiver").length; i++) {
                        if (document.getElementsByClassName("dragReceiver")[i].value) {
                            document.getElementsByClassName("dragReceiver")[i].value = "";
                            dataDeleted = true;
                        }
                    }

                    beDetuneFinder();
                    beBeatingFinder();
                    pitchbpmInput();
                    harmoniCalc();

                    if (!dataDeleted) {
                        for (var i = 0; i < timesReset; i++) { 
                            alert("You have deleted (nothing).");
                        }
                        timesReset++;
                    } else {
                        timesReset--;
                    }
                };
                
                if (popupHidden) {
                    resetter();
                } else {
                    var userInput = prompt("Would you like to reset all data? (or enter 'STOP' to stop this confirmation)");
                    if (userInput == "") {
                        resetter();
                    } else if (userInput == "STOP") {
                        popupHidden = true;
                    }
                }
            }

            // memory management for localStorage items
            function memory(variableName, valueToSet = null) {
                if (valueToSet === null) {
                    return localStorage.getItem(variableName);
                } else {
                    localStorage.setItem(variableName, valueToSet);
                }
            }
            
            // for tap tempo logic and output
            var recordedTaps = [];
            function tapTempo(){

                // calculates the average of the recorded taps, and converts to corresponding tempo
                const averageTaps = function() {
                    var tapDifferences = [];
                    for (var j = 0; j < recordedTaps.length - 1; j++) {
                        tapDifferences.push(recordedTaps[j + 1] - recordedTaps[j]);
                    }
                    var differencesTotal = 0;
                    for (var j = 0; j < tapDifferences.length; j++) {
                        differencesTotal += tapDifferences[j];
                    }
                    return 60000 / (differencesTotal / tapDifferences.length);
                };

                const currentTime = new Date().getTime();

                // if you only want to keep a certain amount of taps for the average
                if (recordedTaps.length >= 20) {recordedTaps.shift();}

                recordedTaps.push(currentTime);
                const lastTapTime = recordedTaps[recordedTaps.length - 2];
                const timeSinceLastTap = currentTime - lastTapTime;

                // if 75% > timeSinceLastTap > 125% of average, reset value.
                if ((Math.min((60000 / timeSinceLastTap), averageTaps()) / Math.max((60000 / timeSinceLastTap), averageTaps())) < .75) {
                    resetTempo();
                    recordedTaps.push(currentTime);
                }
                
                // if there are 2 or more taps, display the average
                if (recordedTaps.length > 1) {
                    memory("MusiUserTempo", Math.floor(averageTaps()));
                    document.getElementById("userTempo").value = Math.floor(averageTaps());
                    showMeterFreqs();
                }
            }
            // for resetting the tap tempo
            function resetTempo() {
                recordedTaps = [];
                 memory("MusiUserTempo", "");
                document.querySelector("#userTempo").value = "";
                bpmInput();
            }

            // for tempo times input checking
            function bpmInput() {
                const userTempo = document.getElementById("userTempo");
                const bpmLabel = document.getElementById("bpmDiv");

                // if a value is entered
                if (userTempo.value) {
                    // and if that value is above 0 (& a num)
                    if (userTempo.value > 0) {
                        memory("MusiUserTempo", userTempo.value);
                    } else {
                        memory("MusiUserTempo", "");
                    }
                } else {
                    memory("MusiUserTempo", "");
                }
                
                showMeterFreqs();
            }

            // for meter and freq output
            function showMeterFreqs() {
                const tempo = memory("MusiUserTempo");
                const freq = memory("MusiUserNote");

                const leftSide = document.getElementById("meter");
                const rightSide = document.getElementById("freqs");

                clearChildren(leftSide, 0);
                clearChildren(rightSide, 0);

                // if one of the output containers has data show the tool tip extras
                if (memory("MusiUserNote") || memory("MusiUserTempo")) {
                    viewController(".dragInfo", "Show");
                    viewController(".meterFreqs", "Show");
                } else {
                    viewController(".dragInfo", "Hide");
                    viewController(".meterFreqs", "Hide");
                }

                // meter logic
                {
                    const bpmLabel = document.querySelector("#bpmDiv");

                    // if a tempo is entered
                    if (tempo) {
                        const userTempo = document.querySelector("#userTempo");

                        userTempo.classList.add("activeSelection");
                        bpmLabel.style.color = "#1de840";

                        // leftSide output box
                        const meterOutputBox = document.getElementById("meter");

                        // clear any children (except input box)
                        clearChildren(meterOutputBox, 1);

                        { // output
                            const barLength  = 60000 / tempo * 4; // length of 1 bar time. 60000 = ms in 1 minute

                            // function for output
                            const timeString = function(noteName, num) {return "["+noteName[0]+"<span class='outputShrink'> "+noteName[1]+"</span>] : <span class='draggableItem' onclick='copyValue(this);' draggable='true'>"+roundNumber(num, 2)+"</span> ms (<span class='draggableItem' onclick='copyValue(this);'>"+roundNumber(convertMsHz(num), 2)+"</span> hz)<br>"};

                            // Calculates from top down. starts out at highest bar count, and counts down to 1 bar
                            for (let i = 6; i > 0; i--) {
                                var barCount = Math.pow(2, i);
                                const barString = barCount+"Bars";
                                meterOutputBox.appendChild(createElement("p", timeString([barCount, "Bars"], barLength * barCount)));
                            }

                            // 1 bar
                            meterOutputBox.appendChild(createElement("p", timeString(["1", "Bar"], barLength)));

                            // continues down from 1 bar, calculating fractional note lengths
                            for (let i = 1; i <= 10; i++) {
                                var denomCount = Math.pow(2, i);
                                const denomString = "1/"+denomCount+"Note";
                                meterOutputBox.appendChild(createElement("p", timeString(["1/"+denomCount, " Note"], barLength / denomCount)));
                            }
                        }
                        bpmLabel.style.marginBottom = "16px";

                    // no current tempo entered
                    } else {
                        userTempo.classList.remove("activeSelection");
                        bpmLabel.style.color = "#555555";
                        clearChildren(leftSide, 0);
                        bpmLabel.style.marginBottom = "0px";
                    }
                }

                // freq logic
                {
                    // if a note is selected
                    if (freq) {
                        const freqOutputBox = document.querySelector("#freqs");

                        clearChildren(freqOutputBox, 0);
                        
                        // calculates up from the lowest octave
                        for (let i = -13; i < 7; i++) {

                            const calcNoteFreq = function(offsetFromA) {
                                // uses st offset from A to calculate note freqs
                                return 440 * Math.pow(Math.pow(2, 1 / 12), offsetFromA);
                            }

                            // calculate the octaveOffset with the current note index (inherently offset from A by 3), and the current octave in the loop
                            var octaveOffset = noteArray.indexOf(freq.split(" ")[0]) + 3 + (12 * i);
                            var noteHz = calcNoteFreq(octaveOffset);

                            const freqString = function(octave, num) {return "[<span class='outputShrink'>Octave </span>"+octave+"] : <span class='draggableItem' onclick='copyValue(this);' draggable='true'>"+roundNumber(num, 2)+"</span> hz (<span class='draggableItem' onclick='copyValue(this);'>"+roundNumber(convertMsHz(num), 2)+"</span> ms) <br>"}
                            freqOutputBox.appendChild(createElement("p", freqString(i+5, noteHz)));
                        } 
                    } else {
                        clearChildren(rightSide, 0);
                        return;
                    }
                }
            }

            // creates an HTML element, with innerHTML
            function createElement(typeName, innerText) {
                var el = document.createElement(typeName);
                el.innerHTML = innerText;
                return el;
            }

            // takes a parent container, and a num of children to keep then removes the rest starting at the lastChild
            function clearChildren(parent, minChildren) {
                if (parent.children.length > minChildren) {
                    var loopLength = parent.children.length - (minChildren - 1);
                    for (let i = 1; i < loopLength; i++) {
                        parent.removeChild(parent.lastChild);
                    }
                }
            }
            
            // show/hide elements for tighter formatting
            function viewController(className, styleType) {
                if (styleType == "Show") {
                    for (var i = 0; i < document.querySelectorAll(className).length; i++) {
                        document.querySelectorAll(className)[i].style.visibility = "visible";
                        document.querySelectorAll(className)[i].style.position = "relative";
                    }
                } else if (styleType == "Hide") {
                    for (var i = 0; i < document.querySelectorAll(className).length; i++) {
                        document.querySelectorAll(className)[i].style.visibility = "hidden";
                        document.querySelectorAll(className)[i].style.position = "absolute";
                    }
                }
            }

            // copy a value when clicked on
            function copyValue(el) {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(el);
                selection.removeAllRanges();
                selection.addRange(range);
                document.execCommand("copy");
            }
                        
            // convert between ms & hz
            function convertMsHz(valueOfOneType) {
                var otherValueType = 1000 / valueOfOneType;
                return otherValueType;
            }
            
            // round number to two decimals
            function roundNumber(num, roundedPlaces) {
                return Number.parseFloat(num).toFixed(roundedPlaces);
            }

            // for scale calculations
            function calculateScale() {

                document.getElementById("relativeNames").innerHTML = "";
                document.getElementById("scaleDegrees").innerHTML = "";

                const keyCheck = memory("MusiUserKey");
                const scaleCheck = memory("MusiUserScale");
                var currentNoteIndex = noteArray.indexOf(keyCheck);

                var builtScale = "";

                // if a key and scale are selected
                if (keyCheck && scaleCheck) {
                    viewController(".scaleInfo", "Show");
                    reloadRelativeBox();
                    const currentScaleSequence = modeSequences[scaleCheck.split(".")[0]];
                    builtScale += noteArray[currentNoteIndex] + " ";
                    currentScaleSequence.split(" ").forEach(function(item, index) {
                        var itemCount;
                        if (item == "W") {
                            itemCount = 2;
                        } else if (item == "H") {
                            itemCount = 1;
                        }
                        getNextKeyFromOffset(currentNoteIndex, itemCount);
                        currentNoteIndex = (currentNoteIndex + itemCount) % noteArray.length;
                        if (index != 6) {
                            if (index == 5) {
                                builtScale += noteArray[currentNoteIndex];
                            } else {
                                builtScale += noteArray[currentNoteIndex] + " ";
                            }
                        }
                    });

                    fixScaleNames(builtScale).forEach(function(item, index) {
                        const originalNames = builtScale.split(" ");
                        document.getElementById("scaleDegrees").appendChild(createElement("li", item+"<br><span style='color: #555;'> "+originalNames[index]+"</span><br>("+(index+1)+") "+getDegree(index, scaleCheck.split(".")[0])));
                    });
                } else {
                    viewController(".scaleInfo", "Hide");
                    document.getElementById("relativeNames").innerHTML = "";
                }
            }
            function fixScaleNames(scaleOrder) {
                var fixedScaleOrder = scaleOrder.split(" ");
                fixedScaleOrder.forEach(function(el, index) {
                    var currentKey = el;
                    var nextKey = this[(index + 1)%this.length];
                    var correctNextKey = "";
                    switch(currentKey[0]) {
                        case "C":
                            correctNextKey = "D";
                            break;
                        case "D":
                            correctNextKey = "E";
                            break;
                        case "E":
                            correctNextKey = "F";
                            break;
                        case "F":
                            correctNextKey = "G";
                            break;
                        case "G":
                            correctNextKey = "A";
                            break;
                        case "A":
                            correctNextKey = "B";
                            break;
                        case "B":
                            correctNextKey = "C";
                            break;
                    }
                    if (nextKey[0] != correctNextKey[0]) {
                        var actualOffset = getOffsetBetweenKeys(currentKey, nextKey, correctNextKey);
                        var correctSymbol = "";
                        switch (actualOffset) {
                            case -2:
                                correctSymbol = "bb";
                                break;
                            case -1:
                                correctSymbol = "b";
                                break;
                            case 1:
                                correctSymbol = "#";
                                break;
                            case 2:
                                correctSymbol = "x";
                                break;
                        }
                        this[(index + 1)%this.length] = correctNextKey + correctSymbol;
                    }
                }, fixedScaleOrder);
                return fixedScaleOrder;
            }
            function getOffsetBetweenKeys(current, currentNext, actualNext) {
                var currentNoteOffset = noteArray.indexOf(currentNext) - noteArray.indexOf(current);
                var correctNoteOffset = noteArray.indexOf(actualNext) - noteArray.indexOf(current);

                var offsetOutput = currentNoteOffset - correctNoteOffset;
                if (offsetOutput < -2) {
                    offsetOutput+=noteArray.length;
                }
                return offsetOutput;
            }
            function getNextKeyFromOffset(currentKeyIndex, incrementAmount) {
                var nextKeyCheck = currentKeyIndex + incrementAmount;
                var nextKeyIndex;
                if (nextKeyCheck > 0) {
                    nextKeyIndex = nextKeyCheck % noteArray.length;
                } else {
                    nextKeyIndex = nextKeyCheck + noteArray.length;
                }

                if (nextKeyIndex == 12) {
                    nextKeyIndex = 0;
                }
                
                return nextKeyIndex;
            }
            function getDegree(degree, scaleMode) {
                var degreeNames = ["Tonic", "Supertonic", "Mediant", "Subdominant", "Dominant", "Sudmediant", "Leading Tone"];
                if (scaleMode == "Aeolian") {
                    degreeNames[6] = "Subtonic";
                }
                return degreeNames[degree];
            }
            // 
            function reloadRelativeBox() {
                // in order to calculate the relative keys box, grab current variabes
                const keyCheck = memory("MusiUserKey");
                const scaleCheck = memory("MusiUserScale");
                const currentNoteIndex = noteArray.indexOf(keyCheck);

                // set some stuff 
                var majorOffset, degreeName = "";

                switch (scaleCheck) {
                    case "Ionian":
                        majorOffset = 0;
                        degreeName = "Ionian";
                        break;
                    case "Dorian":
                        majorOffset = 10;
                        degreeName = "Dorian";
                        break;
                    case "Phrygian":
                        majorOffset = 8;
                        degreeName = "Phrygian";
                        break;
                    case "Lydian":
                        majorOffset = 7;
                        degreeName = "Lydian";
                        break;
                    case "Mixolydian":
                        majorOffset = 5;
                        degreeName = "Mixolydian";
                        break;
                    case "Aeolian":
                        majorOffset = 3;
                        degreeName = "Aeolian";
                        break;
                    case "Locrian":
                        majorOffset = 1;
                        degreeName = "Locrian";
                        break;
                }

                // build output piece by piece
                var outputString = "";

                // first line A...G Ionian...Locrian
                outputString += keyCheck+" "+degreeName+"<span style='margin: 0 4vw;'>|</span>";

                // calculates real* major key based on current key (only Ionian is major)
                outputString += noteArray[getNextKeyFromOffset(currentNoteIndex, majorOffset)]+" Major<span style='margin: 0 4vw;'>|</span>";

                // calculates minor from real major (-3 st)
                outputString += noteArray[getNextKeyFromOffset(getNextKeyFromOffset(currentNoteIndex, majorOffset), -3)]+" Minor";
                document.getElementById("relativeNames").innerHTML = outputString;
            }
            
            // for ebating effect
            function beDetuneFinder() {
                const beReeseNote = Number(document.getElementById("beReeseNote").value);
                const beReeseRate = Number(document.getElementById("beReeseRate").value);

                if (beReeseNote > 0) {
                    memory("MusiBEReeseNote", beReeseNote);
                } else {
                    memory("MusiBEReeseNote", "");
                }

                if (beReeseRate > 0) {
                    memory("MusiBEReeseRate", beReeseRate);
                } else {
                    memory("MusiBEReeseRate", "");
                }

                if (memory("MusiBEReeseNote") && memory("MusiBEReeseRate")) {
                    document.getElementById("beDetuneAmount").innerHTML = "Detune by + "+roundNumber(1200 * Math.log2((beReeseNote + beReeseRate) / beReeseNote), 2)+" cents, or +/- "+roundNumber(1200 * Math.log2((beReeseNote + (beReeseRate / 2), 2) / beReeseNote))+" cents";
                    viewController("#beDetuneAmount", "Show");
                } else {
                    document.getElementById("beDetuneAmount").innerHTML = "";
                    viewController("#beDetuneAmount", "Hide");
                }
            }

            function beBeatingFinder() {
                const beBeatingOne = Number(document.getElementById("beBeatingOne").value);
                const beBeatingTwo = Number(document.getElementById("beBeatingTwo").value);

                if (beBeatingOne > 0) {
                    memory("MusiBEBeatingOne", beBeatingOne);
                } else {
                    memory("MusiBEBeatingOne", "");
                }

                if (beBeatingTwo > 0) {
                    memory("MusiBEBeatingTwo", beBeatingTwo);
                } else {
                    memory("MusiBEBeatingTwo", "");
                }

                if (memory("MusiBEBeatingOne") && memory("MusiBEBeatingTwo")) {

                    document.getElementById("beBeatingAmount").innerHTML = "Beating is "+roundNumber(Math.max(beBeatingOne, beBeatingTwo) - Math.min(beBeatingOne, beBeatingTwo), 2) + " hz";
                    viewController("#beBeatingAmount", "Show");
                } else {
                    document.getElementById("beBeatingAmount").innerHTML = "";
                    viewController("#beBeatingAmount", "Hide");
                }
            }

            // for pitch bpm calculator
            function pitchbpmInput() {
                const pitchBpm = Number(document.getElementById("pitchBpm").value);
                const pitchPitch = Number(document.getElementById("pitchPitch").value);

                if (pitchBpm > 0) {
                    memory("MusiPitchBpm", pitchBpm);
                } else {
                    memory("MusiPitchBpm", "");
                }

                if (pitchPitch != "" & Number.isInteger(pitchPitch)) {
                    memory("MusiPitchPitch", pitchPitch);
                } else {
                    memory("MusiPitchPitch", "");
                }

                if (memory("MusiPitchBpm") && memory("MusiPitchPitch")) {
                    document.getElementById("pitchDif").innerHTML = pitchBpm+" bpm loop "+(pitchPitch > 0 ? "raised " : "lowered ")+Math.abs(pitchPitch)+" st = "+roundNumber(pitchBpm * Math.pow(2, pitchPitch / 12), 2)+" bpm";
                    viewController("#pitchDif", "Show");
                } else {
                    document.getElementById("pitchDif").innerHTML = "";
                    viewController("#pitchDif", "Hide");
                }
            }

            // for harmonic calculator
            function harmoniCalc() {
                const userHarmFreq = document.getElementById("harmonicFreq").value;

                // converts 1, 2, 3... into 1st, 2nd, 3rd...
                const ordinalNumber = function(number) {
                    var suffix = "";

                    // first we check for a few special cases
                    const specialCases = [11, 12, 13];
                    if (specialCases.includes(number)) {
                        suffix = "th"; 
                    } else {
                        // else we apply the general rule
                        switch (String(number)[String(number).length - 1]) {
                            case "0":
                            case "4":
                            case "5":
                            case "6":
                            case "7":
                            case "8":
                            case "9":
                                suffix =  "th";
                                break;
                            case "1":
                                suffix =  "st";
                                break;
                            case "2":
                                suffix =  "nd";
                                break;
                            case "3":
                                suffix =  "rd";
                                break;
                        }
                    }
                    
                    return number+suffix;
                };

                // if there is a entered value
                if (userHarmFreq) {
                    if (userHarmFreq > 0) {

                        memory("MusiHarmFreq", userHarmFreq);
                        const leftside = document.getElementById("oddHarm");
                        const rightside = document.getElementById("evenHarm");
                        
                        clearChildren(leftside, 0);
                        clearChildren(rightside, 0);

                        // only loops as long as it needs to; calculates # of harmonics < 20000 Hz
                        const loopAmount = Math.ceil(20000/userHarmFreq);
                        for (var i=2; i <= loopAmount; i++) {
                            var tempFreq = roundNumber(userHarmFreq * i, 2);

                            // if count is even, add to even side
                            if (i % 2 == 0) {
                                // on first insert, add the odd label & scroll down text
                                if (i == 2) {
                                    leftside.append(createElement('p', 'Odd<br>↓<span style="margin: 0 28%;"></span>↓<br><br>'));
                                    rightside.append(createElement('p', 'Even<br>↓<span style="margin: 0 28%;"></span>↓<br>'));
                                }

                                rightside.append(createElement('p', `${ordinalNumber(i)}: <span>${tempFreq} Hz</span>`));
                                
                            // else add to odd side
                            } else {
                                leftside.append(createElement('p', `${ordinalNumber(i)}: <span>${tempFreq} Hz</span>`));
                            }
                        }
                        viewController(".harmonics", "Show");
                    } else {
                        memory("MusiHarmFreq", "");
                        clearChildren(document.getElementById("oddHarm"), 0);
                        clearChildren(document.getElementById("evenHarm"), 0);
                        viewController(".harmonics", "Hide");
                    }

                // no entered value
                } else {
                    memory("MusiHarmFreq", "");
                    clearChildren(document.getElementById("oddHarm"), 0);
                    clearChildren(document.getElementById("evenHarm"), 0);
                    viewController(".harmonics", "Hide");
                }
            }
        </script>
	</body>
</html>