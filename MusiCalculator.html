<!doctype html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="author" content="Trevor Brown"/>
		<meta name="copyright" content="Copyright © Trevor Brown 2021. All rights reserved.">
		<meta name="viewport" content="width=device-width, initial-scale=1">

        <meta property="og:title" content="MusiCalculator" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://trvrbrwn4.github.io/MusiCalculator.html" />
        <meta property="og:image" content="media/images/meta preview/musicalc meta.png" />
        <meta property="og:description" content="Calculate tempo and key info" />
        <meta name="theme-color" content="#00FF00">

		<title>>TAB [MusiCalculator]</title>
        <link rel="icon" href="media/images/icon.png">
		<link rel="stylesheet" type="text/css" href="styles/siteStyle.css">
        <style>
            body {
                overflow-x: hidden;
            }
            #scaleSelector li { /* User Scale Selector */
                font-size: 24px;
            }
            #relativeNames { /* Calculated Relative Scales */
                font-size: 32px;
            }
            #scaleDegrees li { /* Calculated Scale Keys */
                font-size: 20px;
            }
            .rightSide ul li { /* User Frequency Selector */
                font-size: 24px;
            }
            #output>div>p { /* Both Sets of Outputs (tempo, freq) */
                font-size: 20px;
            }

            h1, h2, h3, h4, h5, h6 { /* Page Title */
                font-size: 48px;
                margin-bottom: 16px;
            }
            .toolBox {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: auto;
                margin: 32px 0;
                border-top: 4px solid #fff;
                border-bottom: 4px solid #fff;
                padding: 32px;
            }
            .toolBox > div {
                display: inline-block;
                margin-bottom: 32px;
            }
            .toolBox input {
                text-align: center;
                color: #777;
                border: none;
                width: 20%;
                font-size: calc(12px + .5vw);
                min-width: 100px;
            }
            .toolBox input:focus::placeholder {
                color: transparent;
            }
            .toolBox input:focus {
                caret-color: #636c72;
            }
            .toolBox ul {
                display: flex;
                flex-direction: row;
                justify-content: space-evenly;
                list-style-type: none;
                cursor: default;
                user-select: none;
            }
            .toolBox ul li {
                display: inline-block;
                list-style-type: none;
                cursor: pointer;
                font-weight: 500;
                transition: all .3s ease;
            }
            #userBPM {
                background-color: transparent;
            }
            #keySelector, #bpmDiv, #scaleSelector {
                color: #555; 
            }
            #keySelector li:hover, #scaleSelector li:hover {
                color: #888;
                border-bottom: 2px solid #888;
                transform: scale(1.05);
            }
            #keySelector li { /* User Key Selector */
                font-size: 24px;
                margin: 0 2vw;
            }
            #scaleSelector li {
                margin: 0 2vw;
            }
            #menuBar {
                width: 80%;
                height: 4px;
                background-color: #fff;
            }
            #relativeNames {
                user-select: none;
                font-weight: 900;
            }
            #scaleDegrees {
                margin-top: -32px;
            }
            #scaleDegrees li {
                cursor: default;
                margin: 0 2vw;
            }
            #bpmDiv {
                margin-bottom: 48px;
            }
            #output {
                width: 98vw;
            }
            .leftSide, .rightSide {
                width: 38%;
                padding: 1%;
                margin: 0 5%;
            }
            .leftSide {
                float: left;
            }
            .rightSide {
                float: right;
            }
            .rightSide ul {
                margin-bottom: 16px;
            }
            .rightSide ul li {
                color: #555;
            }
            #output>div>p {
                margin: 4px 0 0 4px;
                font-weight: 400;
            }
            .draggableItem {
                transition: all .3s ease;
            }
            .draggableItem:hover {
                cursor: pointer;
                color: #1de840;
                text-decoration: underline;
                transform: scale(1.1);
            }
            .draggableItem::selection {
                color: #dd00f3;
                background-color: #333333;
            }
            .extra {
                font-weight: 300;
            }
            .info {
                font-style: italic;
                font-weight:200;
            }
            #pulseRate, #pitchDif {
                font-weight: 800;
            }
            #pulseRate {
                color: #e3e81d;
            }
            #pitchDif{
                color: #1ddde8;
            }

            /******************** MEDIA QUERIES ********************/
            @media only screen and (min-width: 1200px) and (max-width: 4000px) { /* For Bigger Computers */
                h1 { /* Page Title */
                    font-size: 64px;
                }
                h2 { /* Other Titles */
                    font-size: 48px;
                }
                #relativeNames { /* Calculated Relative Scales */
                    font-size: 40px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 24px;
                }
                #output>div>p { /* Both Sets of Outputs (tempo, freq) */
                    font-size: 24px;
                }
                .extra {
                    font-size: 24px;
                }
                .extra > span {
                    padding: 0 64px;
                }
                #pulseRate, #pitchDif {
                    font-size: 28px;
                }
            }
            @media only screen and (max-width: 1200px) { /* For Bigger Computers */
                h1 { /* Page Title */
                    font-size: 48px;
                }
                h2 { /* Other Titles */
                    font-size: 40px;
                }
                #keySelector li { /* User Key Selector */
                    font-size: 16px;
                }
                #scaleSelector li { /* User Scale Selector */
                    font-size: 16px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 16px;
                }
                .rightSide ul li { /* User Frequency Selector */
                    font-size: 16px;
                }
                .extra > span {
                    padding: 0 32px;
                }
                #pulseRate, #pitchDif {
                    font-size: 24px;
                }
            }
            @media only screen and (max-width: 800px) { /* For Smaller Computers */
                h1 { /* Page Title */
                    font-size: 48px;
                }
                h2 { /* Other Titles */
                    font-size: 40px;
                }
                #keySelector li { /* User Key Selector */
                    font-size: 16px;
                }
                #scaleSelector li { /* User Scale Selector */
                    font-size: 16px;
                }
                #relativeNames { /* Calculated Relative Scales */
                    font-size: 20px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 12px;
                }
                .rightSide ul li { /* User Frequency Selector */
                    font-size: 16px;
                    margin: 0 .5vw;
                }
                #output>div>p { /* Both Sets of Outputs (tempo, freq) */
                    font-size: 14px;
                }
                .extra > span {
                    padding: 0 16px;
                }
                #pulseRate, #pitchDif {
                    font-size: 20px;
                }
            }
            @media only screen and (max-width: 600px) { /* For Tablets */
                h1{ /* Page Title */
                    font-size: 36px;
                }
                h2 { /* Other Titles */
                    font-size: 24px;
                }
                #keySelector li { /* User Key Selector */
                    font-size: 12px;
                    margin: 0 1vw;
                }
                #scaleSelector li { /* User Scale Selector */
                    font-size: 12px;
                    margin: 0 1vw;
                }
                #relativeNames { /* Calculated Relative Scales */
                    font-size: 20px;
                }
                #scaleDegrees li { /* Calculated Scale Keys */
                    font-size: 12px;
                    margin: 0 1vw;
                }
                .rightSide ul li { /* User Frequency Selector */
                    font-size: 12px;
                    margin: 0 .5vw;
                }
                #output>div>p { /* Both Sets of Outputs (tempo, freq) */
                    font-size: 10px;
                }
                .extra > span {
                    display: block;
                }
                #pulseRate, #pitchDif {
                    font-size: 16px;
                }
            }
        </style>
	</head>
	<body onload="loader();">
        <div class="toolBox rainbowBorder">
            <h1><strong>MusiCalc</strong></h1>
            <div class="info">Click on highlighted values to copy them to clipboard!</div>
            <div><ul id="keySelector"></ul></div>
            <div><ul id="scaleSelector"></ul></div>
            <span id="menuBar"></span>
            <div></div>
            <div id="relativeNames"></div>
            <div></div>
            <div><ul id="scaleDegrees"></ul></div>
            <div id="output"><div class="leftSide"><div id="bpmDiv"><input type="text" id="userBPM" placeholder="?" oninput="BpmInput();"> BPM</div></div><div class="rightSide"><ul></ul></div></div>
            <div class="info">Click and drag selected items into the boxes below!</div>
            <span id="menuBar"></span>
            <div></div>
            <h2><strong>Detuned Oscillator(s) Pulse Rate Calculator</strong></h2>
            <div class="info">Calculate the detuning of notes for phase cancellation basses</div>
            <div class="extra">Hz of main note: <input type="text" class="dragReceiver" placeholder="?" oninput="reesePulseInput();" id="reeseNote"><span></span>Hz of desired pulsing: <input type="text" class="dragReceiver" placeholder="?" oninput="reesePulseInput();" id="reeseRate"></div>
            <div id="pulseRate"></div>
            <div></div>
            <h2><strong>Pitch BPM Difference Calculator</strong></h2>
            <div class="info">Calculate the new bpm of a pitch altered loop</div>
            <div class="extra">Original BPM: <input type="text" class="dragReceiver" placeholder="?" oninput="pitchBpmInput();" id="pitchBpm"><span></span>Pitch difference (in st): <input type="text" class="dragReceiver" placeholder="?" oninput="pitchBpmInput();" id="pitchPitch"></div>
            <div id="pitchDif"></div>
        </div>
        <div class="footer">
            <ul class="socialMenu">
                <a href="https://www.instagram.com/trvrbrwn4/" target="_blank"><li><img src="media/images/socials/instagram.png"></li></a>
            </ul>
            Copyright © 2022. All rights reserved.
        </div>
        <script src="scripts/wavesurfer.js" type="text/javascript"></script>
		<script src="scripts/siteScript.js" type="text/javascript"></script>
        <script type="text/javascript">

            // colors for easy use
            const selectionColor = "1de840";
            const unselectedColor = "555555";
            
            const userBpm = document.querySelector("#userBPM");
            const bpmDiv = document.querySelector("#bpmDiv");
            const scaleDegreeBox = document.getElementById("scaleDegrees");
            const relativeNameBox = document.getElementById("relativeNames");

            const selectedBpm = localStorage.getItem("MusiUserBPM");
            const selectedKey = localStorage.getItem("MusiUserKey");
            const selectedScale = localStorage.getItem("MusiUserScale");
            const selectedNote = localStorage.getItem("MusiUserNote");

            var notes = "C C# D D# E F F# G G# A A# B";
            const noteArray = notes.split(" ");

            //           C       C#      D       D#      E       F       F#      G       G#      A     A#      B
            var freqs = [16.351, 17.324, 18.354, 19.445, 20.601, 21.827, 23.124, 24.499, 25.956, 27.5, 29.135, 30.868]

            var scales = "Ionian (Major) : Dorian : Phrygian : Lydian : Mixolydian : Aeolian (Minor) : Locrian";
            const scaleArray = scales.split(" : ");
            const modeSequences = {
                "Ionian": "W W H W W W H",
                "Dorian": "W H W W W H W",
                "Phrygian": "H W W W H W W",
                "Lydian": "W W W H W W H",
                "Mixolydian": "W W H W W H W",
                "Aeolian": "W H W W H W W",
                "Locrian": "H W W H W W W"
            };

            // on load, populate the selectors and append any stored data
            window.onload = function() {

                // creates key selector
                noteArray.forEach(function(item, index) {
                    var li = document.createElement("li");
                    li.id = item;
                    li.innerHTML = item;
                    li.addEventListener("click", function() {
                        // grab 'old' key (the currently selected key when clicked)
                        var oldKeyName = localStorage.getItem("MusiUserKey");
                                       
                        if (oldKeyName) {
                            if (oldKeyName == this.innerHTML) {
                                setSelectionColorsNew(this, unselectedColor);
                                localStorage.setItem("MusiUserKey", "");
                            } else {
                                var oldKey = document.getElementById(oldKeyName);
                                setSelectionColorsNew(oldKey, unselectedColor);

                                setSelectionColorsNew(this, selectionColor);
                                localStorage.setItem("MusiUserKey", this.innerHTML);
                            }
                        } else {
                            setSelectionColorsNew(this, selectionColor);
                            localStorage.setItem("MusiUserKey", this.innerHTML);
                        }
                        calculateScale();
                    });
                    document.querySelector("#keySelector").appendChild(li);
                });

                // creates scale selector
                scaleArray.forEach(function(item, index) {
                    var li = document.createElement("li");
                    li.id = item.split(" ")[0];
                    li.innerHTML = item;
                    li.addEventListener("click", function() {
                        var oldScaleName = localStorage.getItem("MusiUserScale");

                        if (oldScaleName != "") {
                            if (!document.getElementById(oldScaleName)) {
                                localStorage.setItem("MusiUserScale", "");
                                oldScaleName = "";
                            }
                            
                            if (oldScaleName) {
                                if (oldScaleName == this.innerHTML.split(" ")[0]) {
                                    setSelectionColorsNew(this, unselectedColor);
                                    localStorage.setItem("MusiUserScale", "");
                                } else {
                                    var oldScale = document.getElementById(oldScaleName);
                                    setSelectionColorsNew(oldScale, unselectedColor);

                                    setSelectionColorsNew(this, selectionColor);
                                    localStorage.setItem("MusiUserScale", this.innerHTML.split(" ")[0]);
                                }
                            }
                        } else {
                            setSelectionColorsNew(this, selectionColor);
                            localStorage.setItem("MusiUserScale", this.innerHTML.split(" ")[0]);
                        }
                        calculateScale();
                    });
                    document.querySelector("#scaleSelector").appendChild(li);
                });

                // creates note selector
                noteArray.forEach(function(item, index) {
                    var li = document.createElement("li");
                    li.id = item+" "+index;
                    li.innerHTML = item;
                    li.addEventListener("click", function() {
                        var oldNoteName = localStorage.getItem("MusiUserNote");

                        if (oldNoteName != "") {
                            if (!document.getElementById(oldNoteName)) {
                                localStorage.setItem("MusiUserNote", "");
                                oldNoteName = "";
                            }
                            
                            if (oldNoteName) {
                                if (oldNoteName.split(" ")[0] == this.innerHTML) {
                                    setSelectionColorsNew(this, unselectedColor);
                                    localStorage.setItem("MusiUserNote", "");
                                } else {
                                    var oldNote = document.getElementById(oldNoteName);
                                    setSelectionColorsNew(oldNote, unselectedColor);

                                    setSelectionColorsNew(this, selectionColor);
                                    localStorage.setItem("MusiUserNote", this.id);
                                }
                            }
                        } else {
                            setSelectionColorsNew(this, selectionColor);
                            localStorage.setItem("MusiUserNote", this.id);
                        }
                        showNoteFreq(this.innerHTML);
                    });
                    document.querySelector(".rightSide").firstChild.appendChild(li);
                });

                // adds drop functionality to the extra textboxes
                for (var i = 0; i < document.getElementsByClassName("dragReceiver").length; i++) {
                    document.getElementsByClassName("dragReceiver")[i].addEventListener("drop", function(event) {
                        event.preventDefault();
                        this.value = "";
                        this.value = event.dataTransfer.getData("Text");
                        if (this.attributes.oninput.value.slice(0, this.attributes.oninput.value.length - 3) === reesePulseInput.name) {
                            reesePulseInput();
                            
                        } else {
                            pitchBpmInput();
                        }
                    });
                }

                // appends available values/data from previous session
                if (selectedBpm) {
                    userBpm.value = selectedBpm;
                    bpmDiv.style.color = "#"+selectionColor;
                    setSelectionColorsNew(userBpm, selectionColor);
                    calculateTempoTimes(userBpm.value);
                }
                if (selectedKey) {
                    var currentKey = document.getElementById(selectedKey);
                    if (currentKey) {
                        setSelectionColorsNew(currentKey, selectionColor);
                    }
                }
                if (selectedScale) {
                    var currentScale = document.getElementById(selectedScale);
                    if (currentScale) {
                        setSelectionColorsNew(currentScale, selectionColor);
                    } 
                }
                if (selectedKey && selectedScale) {
                    calculateScale();
                }
                if (selectedNote) {
                    var currentNoteBox = document.getElementById(selectedNote);
                    if (currentNoteBox) {
                        setSelectionColorsNew(currentNoteBox, selectionColor);
                        showNoteFreq(selectedNote.split(" ")[0]);
                    }
                }

                // call functions of the 'Extras' to fire
                reesePulseInput();
                pitchBpmInput();
            };

            // on bpm input box change, check if empty
                var userBpm = document.querySelector("#userBPM");

                if (userBpm.value) {
                    localStorage.setItem("MusiUserBPM", userBpm.value);
                    setSelectionColorsNew(userBpm, selectionColor);
                    bpmDiv.style.color = "#"+selectionColor;
                } else {
                    localStorage.setItem("MusiUserBPM", "");
                    setSelectionColorsNew(userBpm, unselectedColor);
                    bpmDiv.style.color = "#"+unselectedColor;
                    
                }
                
                calculateTempoTimes(userBpm.value);
            }
            function setSelectionColorsNew(div, hexString) {
                div.style.color = "#"+hexString;
                if (hexString != unselectedColor) {
                    div.style.borderBottom = "4px solid #"+hexString;
                } else {
                    div.style.borderBottom = "none";
                }
            }
            function createElement(typeName, innerText) {
                var el = document.createElement(typeName);
                el.innerHTML = innerText;
                return el;
            }
            
            function calculateTempoTimes(bpm) {

                // leftSide box
                var outputBox = document.getElementById("output").children[0];

                // if input box is empty, clear output and return
                if (document.getElementById("userBPM").value == "") {
                    var loopLength = outputBox.children.length;
                    for (let i = 1; i < loopLength; i++) {
                        outputBox.removeChild(outputBox.lastChild);
                    }
                    return;
                }

                // if there is present output, remove to refresh data
                if (outputBox.children.length != 1) {
                    var loopLength = outputBox.children.length;
                    for (let i = 1; i < loopLength; i++) {
                        outputBox.removeChild(outputBox.lastChild);
                    }
                }

                var barLength  = 60000 / bpm * 4; // length of 1 bar time

                // output

                // Calculates from top down. starts out at highest bar count, and counts down to 1 bar
                for (let i = 6; i > 0; i--) {
                    var barCount = Math.pow(2, i);
                    var barString = barCount+" Bars";
                    newOutputLine(timeString(barString, barLength * barCount), outputBox);
                }

                // 1 bar
                newOutputLine(timeString("1 Bar", barLength), outputBox);

                // continues down from 1 bar, calculating fractional note lengths
                for (let i = 1; i <= 11; i++) {
                    var denomCount = Math.pow(2, i);
                    var denomString = "1/"+denomCount+" Note";
                    newOutputLine(timeString(denomString, barLength / denomCount), outputBox);
                }
            }
            function copyValue(el) {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(el);
                selection.removeAllRanges();
                selection.addRange(range);
                document.execCommand("copy");
            }
            function newOutputLine(lineText, outContainer) {
                var newLine = createElement("p", lineText);
                outContainer.appendChild(newLine);
            }
            // converts noteName and num to a string for output
            function timeString(noteName, num) {
                var output = noteName+" : <span class='draggableItem' onclick='copyValue(this);'>"+roundNumber(num)+"</span> ms (<span class='draggableItem' onclick='copyValue(this);'>"+roundNumber(convertMsHz(num))+"</span> hz)<br>";
                return output;
            }
            function convertMsHz(valueOfOneType) {
                var otherValueType = 1000 / valueOfOneType;
                return otherValueType;
            }
            function roundNumber(num) {
                return Number.parseFloat(num).toFixed(2);
            }

            function calculateScale() {
                relativeNameBox.innerHTML = "";
                scaleDegreeBox.innerHTML = "";

                var keyCheck = localStorage.getItem("MusiUserKey");
                var scaleCheck = localStorage.getItem("MusiUserScale");
                var currentNoteIndex = noteArray.indexOf(keyCheck);

                var builtScale = "";
                if (keyCheck && scaleCheck) {
                    reloadRelativeBox();
                    var currentScaleSequence = modeSequences[scaleCheck.split(".")[0]];
                    builtScale += noteArray[currentNoteIndex] + " ";
                    currentScaleSequence.split(" ").forEach(function(item, index) {
                        var itemCount;
                        if (item == "W") {
                            itemCount = 2;
                        } else if (item == "H") {
                            itemCount = 1;
                        }
                        getNextKeyFromOffset(currentNoteIndex, itemCount);
                        currentNoteIndex = (currentNoteIndex + itemCount) % noteArray.length;
                        if (index != 6) {
                            if (index == 5) {
                                builtScale += noteArray[currentNoteIndex];
                            } else {
                                builtScale += noteArray[currentNoteIndex] + " ";
                            }
                        }
                    });
                    //console.clear();

                    fixScaleNames(builtScale).forEach(function(item, index) {
                        var originalNames = builtScale.split(" ");
                        var li = document.createElement("li");
                        li.innerHTML = item+"<br><span style='color: #555;'> "+originalNames[index]+"</span><br>("+(index+1)+") "+getDegree(index, scaleCheck.split(".")[0]);
                        scaleDegreeBox.appendChild(li);
                    });
                } else {
                    relativeNameBox.innerHTML = "";
                }
            }
            function fixScaleNames(scaleOrder) {
                var fixedScaleOrder = scaleOrder.split(" ");
                fixedScaleOrder.forEach(function(el, index) {
                    var currentKey = el;
                    var nextKey = this[(index + 1)%this.length];
                    var correctNextKey = "";
                    switch(currentKey[0]) {
                        case "C":
                            correctNextKey = "D";
                            break;
                        case "D":
                            correctNextKey = "E";
                            break;
                        case "E":
                            correctNextKey = "F";
                            break;
                        case "F":
                            correctNextKey = "G";
                            break;
                        case "G":
                            correctNextKey = "A";
                            break;
                        case "A":
                            correctNextKey = "B";
                            break;
                        case "B":
                            correctNextKey = "C";
                            break;
                    }
                    if (nextKey[0] != correctNextKey[0]) {
                        var actualOffset = getOffsetBetweenKeys(currentKey, nextKey, correctNextKey);
                        var correctSymbol = "";
                        switch (actualOffset) {
                            case -2:
                                correctSymbol = "bb";
                                break;
                            case -1:
                                correctSymbol = "b";
                                break;
                            case 1:
                                correctSymbol = "#";
                                break;
                            case 2:
                                correctSymbol = "x";
                                break;
                        }
                        this[(index + 1)%this.length] = correctNextKey + correctSymbol;
                    }
                }, fixedScaleOrder);
                return fixedScaleOrder;
            }
            function getOffsetBetweenKeys(current, currentNext, actualNext) {
                var currentNoteOffset = noteArray.indexOf(currentNext) - noteArray.indexOf(current);
                var correctNoteOffset = noteArray.indexOf(actualNext) - noteArray.indexOf(current);

                var offsetOutput = currentNoteOffset - correctNoteOffset;
                if (offsetOutput < -2) {
                    offsetOutput+=noteArray.length;
                }
                return offsetOutput;
            }

            function getNextKeyFromOffset(currentKeyIndex, incrementAmount) {
                var nextKeyCheck = currentKeyIndex + incrementAmount;
                var nextKeyIndex;
                if (nextKeyCheck > 0) {
                    nextKeyIndex = nextKeyCheck % noteArray.length;
                } else {
                    nextKeyIndex = nextKeyCheck + noteArray.length;
                }

                if (nextKeyIndex == 12) {
                    nextKeyIndex = 0;
                }
                
                return nextKeyIndex;
            }
            function getDegree(degree, scaleMode) {
                var degreeNames = ["Tonic", "Supertonic", "Mediant", "Subdominant", "Dominant", "Sudmediant", "Leading Tone"];
                if (scaleMode == "Aeolian") {
                    degreeNames[6] = "Subtonic";
                }
                return degreeNames[degree];
            }
            
            function reloadRelativeBox() {
                // in order to calculate the relative keys box, grab current variabes
                var keyCheck = localStorage.getItem("MusiUserKey");
                var scaleCheck = localStorage.getItem("MusiUserScale");
                var currentNoteIndex = noteArray.indexOf(keyCheck);

                // set some stuff 
                var majorOffset, degreeName = "";

                switch (scaleCheck) {
                    case "Ionian":
                        majorOffset = 0;
                        degreeName = "Ionian";
                        break;
                    case "Dorian":
                        majorOffset = 10;
                        degreeName = "Dorian";
                        break;
                    case "Phrygian":
                        majorOffset = 8;
                        degreeName = "Phrygian";
                        break;
                    case "Lydian":
                        majorOffset = 7;
                        degreeName = "Lydian";
                        break;
                    case "Mixolydian":
                        majorOffset = 5;
                        degreeName = "Mixolydian";
                        break;
                    case "Aeolian":
                        majorOffset = 3;
                        degreeName = "Aeolian";
                        break;
                    case "Locrian":
                        majorOffset = 1;
                        degreeName = "Locrian";
                        break;
                }

                // build output piece by piece
                var outputString = "";

                // first line A...G Ionian...Locrian
                outputString += "["+keyCheck+"] "+degreeName+"<span style='margin: 0 4vw;'>|</span>";

                // calculates real* major key based on current key (only Ionian is major)
                outputString += "["+noteArray[getNextKeyFromOffset(currentNoteIndex, majorOffset)]+"] Major<span style='margin: 0 4vw;'>|</span>";

                // calculates minor from real major (-3 st)
                outputString += "["+noteArray[getNextKeyFromOffset(getNextKeyFromOffset(currentNoteIndex, majorOffset), -3)]+"] Minor";
                relativeNameBox.innerHTML = outputString;
            }

            function freqString(octave, num) {
                var output = "Octave "+octave+": <span class='draggableItem' onclick='copyValue(this);'>"+roundNumber(num)+"</span> hz (<span class='draggableItem' onclick='copyValue(this);'>"+roundNumber(convertMsHz(num))+"</span> ms) <br>";
                return output;
            }
            function showNoteFreq(noteName) {
                var parentBox = document.querySelector(".rightSide");

                if (!(localStorage.getItem("MusiUserNote"))) {
                    var loopLength = parentBox.children.length;
                    for (let i = 1; i < loopLength; i++) {
                        parentBox.removeChild(parentBox.lastChild);
                    }
                    return;
                }

                if (parentBox.children.length != 1) {
                    var loopLength = parentBox.children.length;
                    for (let i = 1; i < loopLength; i++) {
                        parentBox.removeChild(parentBox.lastChild);
                    }
                }

                for (let i = -13; i < 7; i++) { // calculates up from the lowest octave
                    var octaveOffset = noteArray.indexOf(noteName) + (12 * i) + 3;
                    var noteHz = calcNoteFreq(octaveOffset);
                    newOutputLine(freqString(i+5, noteHz), parentBox);
                }
            }
            function calcNoteFreq(offsetFromA) {
                var noteHz = 440 * Math.pow(Math.pow(2, 1 / 12), offsetFromA)
                return noteHz;
            }
            
            // for pulse rate calculator
            function reesePulseInput() {
                var reeseNote = Number(document.getElementById("reeseNote").value);
                var reeseRate = Number(document.getElementById("reeseRate").value);

                if (reeseNote && reeseRate) {
                    document.getElementById("pulseRate").innerHTML = "+ "+roundNumber(1200 * Math.log2((reeseNote+reeseRate)/reeseNote))+" cents, or +/- "+roundNumber((1200 * Math.log2((reeseNote+reeseRate)/reeseNote))/2)+" cents";
                } else {
                    document.getElementById("pulseRate").innerHTML = "";
                }
            }

            // for pitch bpm calculator
            function pitchBpmInput() {
                var pitchBpm = Number(document.getElementById("pitchBpm").value);
                var pitchPitch = Number(document.getElementById("pitchPitch").value);

                if (pitchBpm && pitchPitch) {
                    
                    document.getElementById("pitchDif").innerHTML = pitchBpm+" bpm loop "+(pitchPitch > 0 ? "raised " : "lowered ")+Math.abs(pitchPitch)+" st = "+roundNumber(pitchBpm * Math.pow(2, pitchPitch / 12))+" bpm";
                } else {
                    document.getElementById("pitchDif").innerHTML = "";
                }
            }

            // reset local variables and site stuff
            function resetData() {
                var backupBpm = localStorage.getItem("MusiUserBPM");
                var backupKey = localStorage.getItem("MusiUserKey");
                var backupScale = localStorage.getItem("MusiUserScale");
                
                localStorage.setItem("MusiUserKey", "");
                localStorage.setItem("MusiUserBPM", "");
                userBpm.value = "";
                localStorage.setItem("MusiUserScale", "");

                setSelectionColorsNew(userBpm, "ffffff");
                setSelectionColorsNew(bpmDiv, "ffffff");
                setSelectionColorsNew(document.getElementById(backupKey), "ffffff");
                setSelectionColorsNew(document.getElementById(backupScale), "ffffff");
            }
        </script>
	</body>
</html>